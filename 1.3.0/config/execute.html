

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Execute &mdash; MPAS-Analysis 1.3.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Dask threads and subprocess count" href="dask_threads.html" />
    <link rel="prev" title="Runs" href="runs.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> MPAS-Analysis
          

          
          </a>

          
            
            
              <div class="version">
                1.3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quick_start.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../configuration.html">Configuration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="runs.html">Runs</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Execute</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#parallel-tasks">Parallel Tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parallelism-in-nco">Parallelism in NCO</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dask_threads.html">Dask threads and subprocess count</a></li>
<li class="toctree-l2"><a class="reference internal" href="diagnostics.html">Diagnostics</a></li>
<li class="toctree-l2"><a class="reference internal" href="input.html">Input</a></li>
<li class="toctree-l2"><a class="reference internal" href="output.html">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="climatology.html">Climatology</a></li>
<li class="toctree-l2"><a class="reference internal" href="timeSeries.html">Time Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html">Index</a></li>
<li class="toctree-l2"><a class="reference internal" href="regions.html">Regions</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot.html">Plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="html.html">HTML</a></li>
<li class="toctree-l2"><a class="reference internal" href="observations.html">Ocean, Sea Ice and Iceberg Observations</a></li>
<li class="toctree-l2"><a class="reference internal" href="preprocessed.html">Preprocessed Reference Runs</a></li>
<li class="toctree-l2"><a class="reference internal" href="colormaps.html">Colormaps</a></li>
<li class="toctree-l2"><a class="reference internal" href="seasons.html">Seasons</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_grids.html">Comparison Grids</a></li>
<li class="toctree-l2"><a class="reference internal" href="moving_average.html">Moving Average</a></li>
<li class="toctree-l2"><a class="reference internal" href="time_axis_ticks.html">Time-Axis Tick Marks</a></li>
<li class="toctree-l2"><a class="reference internal" href="transects.html">Output Grids for Transects</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../analysis_tasks.html">Analysis Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../components.html">MPAS Components and E3SM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../observations.html">Observations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design_docs.html">Design Documents</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">Main Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html#contributors">Contributors</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../versions.html">Versions</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MPAS-Analysis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../configuration.html">Configuration</a> &raquo;</li>
        
      <li>Execute</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/config/execute.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="execute">
<span id="config-execute"></span><h1>Execute<a class="headerlink" href="#execute" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">[execute]</span></code> section of a configuration file contains options used to
control how tasks are executed within an MPAS-Analysis run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">execute</span><span class="p">]</span>
<span class="c1"># the number of parallel tasks (1 means tasks run in serial, the default)</span>
<span class="n">parallelTaskCount</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># the parallelism mode in ncclimo (&quot;serial&quot;, &quot;bck&quot; or &quot;mpi&quot;)</span>
<span class="c1"># Set this to &quot;bck&quot; (background parallelism) in most cases.  The default number</span>
<span class="c1"># of threads (see below) is 12, one for each monthly climatology. Set to &quot;mpi&quot;</span>
<span class="c1"># to run one MPI task on each node and however many threads per node to reach</span>
<span class="c1"># 12 total threads.</span>
<span class="n">ncclimoParallelMode</span> <span class="o">=</span> <span class="n">serial</span>

<span class="c1"># the number of total threads to use when ncclimo runs in &quot;bck&quot; or &quot;mpi&quot; mode.</span>
<span class="c1"># Reduce this number if ncclimo is crashing (maybe because it is out of memory).</span>
<span class="c1"># The number of threads must be a factor of 12 (1, 2, 3, 4, 6 or 12).</span>
<span class="n">ncclimoThreads</span> <span class="o">=</span> <span class="mi">12</span>

<span class="c1"># the number of MPI tasks to use in creating mapping files (1 means tasks run in</span>
<span class="c1"># serial, the default)</span>
<span class="n">mapMpiTasks</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="section" id="parallel-tasks">
<h2>Parallel Tasks<a class="headerlink" href="#parallel-tasks" title="Permalink to this headline">¶</a></h2>
<p>By default, MPAS-Analysis runs one task at a time, displaying any logging
output directly to the screen, rather than storing it in log files.  However,
the analysis will run much more quickly if parallel processes are used. For
example, to run 12 tasks in parallel, simply set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">parallelTaskCount</span> <span class="o">=</span> <span class="mi">12</span>
</pre></div>
</div>
<p>MPAS-Analysis currently supports parallelism through spawning processes, rather
than with MPI, meaning that MPAS-Analysis should be run on a single node of a
multi-node machine such as a cluster or supercomputer.  Given that some tasks
themselves spawn multiple threads and that some tasks are memory intensive, it
may not be desirable to launch one task per core on a node with limited memory.</p>
<p>Because MPAS-Analysis does not use MPI parallelism, it can typically be run on
the login nodes of supercomputing facilities.  Check with the policies of your
center to see if this is permitted and make sure not to run with a large number
of parallel tasks so as to overwhelm the shared resource.</p>
</div>
<div class="section" id="parallelism-in-nco">
<h2>Parallelism in NCO<a class="headerlink" href="#parallelism-in-nco" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">ncclimo</span></code> command from the <a class="reference external" href="http://nco.sourceforge.net/nco.html">NetCDF Operators (NCO) package</a> is used
internally in MPAS-Analysis. This command supports three options for
parallelism: <code class="docutils literal notranslate"><span class="pre">serial</span></code>, <code class="docutils literal notranslate"><span class="pre">bck</span></code> or <code class="docutils literal notranslate"><span class="pre">mpi</span></code>.  If set to <code class="docutils literal notranslate"><span class="pre">serial</span></code>, the
default, any MPAS-Analysis tasks that use <code class="docutils literal notranslate"><span class="pre">ncclimo</span></code> will compute
climatologies one month and then one season at a time.  If <code class="docutils literal notranslate"><span class="pre">bck</span></code> mode is
used, <code class="docutils literal notranslate"><span class="pre">ncclimoThreads</span></code> threads are spawned (default is 12, one for each
month), and then separate threads are used to compute each season.  Given that
computing climatologies takes up a significant portion of the runtime in
MPAS-Analysis, the speed-up of nearly a factor of <code class="docutils literal notranslate"><span class="pre">ncclimoThreads</span></code> in these
computations can be quite noticeable.  For very big data sets, it may be
necessary to run <code class="docutils literal notranslate"><span class="pre">ncclimo</span></code> either with fewer threads (reducing
<code class="docutils literal notranslate"><span class="pre">ncclimoThreads</span></code>, noting that it must be a factor of 12) or on multiple nodes
to prevent running out of memory.  To run an MPI job, spawn a job with between
2 and 12 nodes, and set <code class="docutils literal notranslate"><span class="pre">ncclimoParallelMode</span> <span class="pre">=</span> <span class="pre">mpi</span></code> to run the 12 <code class="docutils literal notranslate"><span class="pre">ncclimo</span></code>
threads on multiple nodes.</p>
<p>Again, when running MPAS-Analysis on login nodes of supercomputing facilities,
it is important to be aware of the policies regarding using shared resources.
On login nodes, <code class="docutils literal notranslate"><span class="pre">bck</span></code> may only be appropriate with <code class="docutils literal notranslate"><span class="pre">ncclimoThreads</span></code> set to a
small number and <code class="docutils literal notranslate"><span class="pre">mpi</span></code> mode may not work at all.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="dask_threads.html" class="btn btn-neutral float-right" title="Dask threads and subprocess count" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="runs.html" class="btn btn-neutral float-left" title="Runs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright This software is open source software available under the BSD-3license. Copyright (c) 2020 Triad National Security, LLC. All rights reserved. Copyright (c) 2018 Lawrence Livermore National Security, LLC. All rights reserved. Copyright (c) 2018 UT-Battelle, LLC. All rights reserved.

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>