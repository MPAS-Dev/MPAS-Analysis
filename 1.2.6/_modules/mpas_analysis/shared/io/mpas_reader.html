

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mpas_analysis.shared.io.mpas_reader &mdash; MPAS-Analysis 1.2.6 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> MPAS-Analysis
          

          
          </a>

          
            
            
              <div class="version">
                1.2.6
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../quick_start.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../analysis_tasks.html">Analysis Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../components.html">MPAS Components and E3SM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../observations.html">Observations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../design_docs.html">Design Documents</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../authors.html">Main Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../authors.html#contributors">Contributors</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">MPAS-Analysis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>mpas_analysis.shared.io.mpas_reader</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for mpas_analysis.shared.io.mpas_reader</h1><div class="highlight"><pre>
<span></span><span class="c1"># This software is open source software available under the BSD-3 license.</span>
<span class="c1">#</span>
<span class="c1"># Copyright (c) 2019 Triad National Security, LLC. All rights reserved.</span>
<span class="c1"># Copyright (c) 2019 Lawrence Livermore National Security, LLC. All rights</span>
<span class="c1"># reserved.</span>
<span class="c1"># Copyright (c) 2019 UT-Battelle, LLC. All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Additional copyright and license information can be found in the LICENSE file</span>
<span class="c1"># distributed with this code, or at</span>
<span class="c1"># https://raw.githubusercontent.com/MPAS-Dev/MPAS-Analysis/master/LICENSE</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Utility functions for reading a single MPAS file into xarray and for removing</span>
<span class="sd">all but a given list of variables from a data set.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># Authors</span>
<span class="c1"># -------</span>
<span class="c1"># Xylar Asay-Davis</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> \
    <span class="n">unicode_literals</span>

<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">import</span> <span class="nn">xarray</span>

<span class="kn">from</span> <span class="nn">mpas_analysis.shared.timekeeping.utility</span> <span class="k">import</span> \
    <span class="n">string_to_days_since_date</span><span class="p">,</span> <span class="n">days_to_datetime</span>


<div class="viewcode-block" id="open_mpas_dataset"><a class="viewcode-back" href="../../../../generated/mpas_analysis.shared.io.open_mpas_dataset.html#mpas_analysis.shared.io.open_mpas_dataset">[docs]</a><span class="k">def</span> <span class="nf">open_mpas_dataset</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">calendar</span><span class="p">,</span>
                      <span class="n">timeVariableNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;xtime_startMonthly&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;xtime_endMonthly&#39;</span><span class="p">],</span>
                      <span class="n">variableList</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">startDate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endDate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  <span class="c1"># {{{</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Opens and returns an xarray data set given file name(s) and the MPAS</span>
<span class="sd">    calendar name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fileName : str</span>
<span class="sd">        File path to read</span>

<span class="sd">    calendar : {``&#39;gregorian&#39;``, ``&#39;gregorian_noleap&#39;``}, optional</span>
<span class="sd">        The name of one of the calendars supported by MPAS cores</span>

<span class="sd">    timeVariableNames : str or list of 2 str, optional</span>
<span class="sd">        The name of the time variable (typically ``&#39;xtime&#39;``</span>
<span class="sd">        or ``[&#39;xtime_startMonthly&#39;, &#39;xtime_endMonthly&#39;]``), or ``None`` if</span>
<span class="sd">        time does not need to be parsed (and is already in the ``Time``</span>
<span class="sd">        variable)</span>

<span class="sd">    variableList : list of strings, optional</span>
<span class="sd">        If present, a list of variables to be included in the data set</span>

<span class="sd">    startDate, endDate : string or datetime.datetime, optional</span>
<span class="sd">        If present, the first and last dates to be used in the data set.  The</span>
<span class="sd">        time variable is sliced to only include dates within this range.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ds : ``xarray.Dataset``</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError</span>
<span class="sd">        If the time variable has an unsupported type (not a date string).</span>

<span class="sd">    ValueError</span>
<span class="sd">        If the time variable is not found in the data set</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Authors</span>
    <span class="c1"># -------</span>
    <span class="c1"># Xylar Asay-Davis</span>

    <span class="n">ds</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">decode_cf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">decode_times</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                             <span class="n">lock</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">timeVariableNames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">_parse_dataset_time</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">timeVariableNames</span><span class="p">,</span> <span class="n">calendar</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">startDate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">endDate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">startDate</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="n">startDate</span> <span class="o">=</span> <span class="n">string_to_days_since_date</span><span class="p">(</span><span class="n">dateString</span><span class="o">=</span><span class="n">startDate</span><span class="p">,</span>
                                                  <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">endDate</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="n">endDate</span> <span class="o">=</span> <span class="n">string_to_days_since_date</span><span class="p">(</span><span class="n">dateString</span><span class="o">=</span><span class="n">endDate</span><span class="p">,</span>
                                                <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">)</span>

        <span class="c1"># select only the data in the specified range of dates</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">Time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">startDate</span><span class="p">,</span> <span class="n">endDate</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The data set contains no Time entries between &#39;</span>
                         <span class="s1">&#39;dates </span><span class="si">{}</span><span class="s1"> and </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                             <span class="n">days_to_datetime</span><span class="p">(</span><span class="n">startDate</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">),</span>
                             <span class="n">days_to_datetime</span><span class="p">(</span><span class="n">endDate</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">variableList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">subset_variables</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">variableList</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ds</span>  <span class="c1"># }}}</span></div>


<span class="k">def</span> <span class="nf">subset_variables</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">variableList</span><span class="p">):</span>  <span class="c1"># {{{</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a data set and a list of variable names, returns a new data set that</span>
<span class="sd">    contains only variables with those names.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds : ``xarray.DataSet`` object</span>
<span class="sd">        The data set from which a subset of variables is to be extracted.</span>

<span class="sd">    variableList : string or list of strings</span>
<span class="sd">        The names of the variables to be extracted.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ds : ``xarray.DataSet`` object</span>
<span class="sd">        A copy of the original data set with only the variables in</span>
<span class="sd">        variableList.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the resulting data set is empty.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Authors</span>
    <span class="c1"># -------</span>
    <span class="c1"># Phillip J. Wolfram, Xylar Asay-Davis</span>

    <span class="n">allvars</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="c1"># get set of variables to drop (all ds variables not in vlist)</span>
    <span class="n">dropvars</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">allvars</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">variableList</span><span class="p">)</span>

    <span class="c1"># drop spurious variables</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">dropvars</span><span class="p">)</span>

    <span class="c1"># must also drop all coordinates that are not associated with the variables</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">avar</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">coords</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">avar</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">dropcoords</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">coords</span>

    <span class="c1"># drop spurious coordinates</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">dropcoords</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s1">&#39;Empty dataset is returned.</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;Variables </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;are not found within the dataset &#39;</span>
            <span class="s1">&#39;variables: </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variableList</span><span class="p">,</span> <span class="n">allvars</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">ds</span>  <span class="c1"># }}}</span>


<span class="k">def</span> <span class="nf">_parse_dataset_time</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">inTimeVariableName</span><span class="p">,</span> <span class="n">calendar</span><span class="p">,</span>
                        <span class="n">outTimeVariableName</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span>
                        <span class="n">referenceDate</span><span class="o">=</span><span class="s1">&#39;0001-01-01&#39;</span><span class="p">):</span>  <span class="c1"># {{{</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A helper function for computing a time coordinate from an MPAS time</span>
<span class="sd">    variable.  Given a data set and a time variable name (or list of 2</span>
<span class="sd">    time names), returns a new data set with time coordinate</span>
<span class="sd">    `outTimeVariableName` filled with days since `referenceDate`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds : ``xarray.DataSet``</span>
<span class="sd">        The data set containing an MPAS time variable to be used to build</span>
<span class="sd">        an xarray time coordinate.</span>

<span class="sd">    inTimeVariableName : str or tuple or list of str</span>
<span class="sd">        The name of the time variable in the MPAS data set that will be</span>
<span class="sd">        used to build the &#39;Time&#39; coordinate.  The array(s) named by</span>
<span class="sd">        inTimeVariableName should contain date strings.  Typically,</span>
<span class="sd">        inTimeVariableName is ``&#39;xtime&#39;``. If a list of two variable</span>
<span class="sd">        names is provided, times from the two are averaged together to</span>
<span class="sd">        determine the value of the time coordinate.  In such cases,</span>
<span class="sd">        inTimeVariableName is typically</span>
<span class="sd">        ``[&#39;xtime_startMonthly&#39;, &#39;xtime_endMonthly&#39;]``.</span>

<span class="sd">    calendar : {&#39;gregorian&#39;, &#39;gregorian_noleap&#39;}</span>
<span class="sd">        The name of one of the calendars supported by MPAS cores</span>

<span class="sd">    outTimeVariableName : str</span>
<span class="sd">        The name of the coordinate to assign times to, typically &#39;Time&#39;.</span>

<span class="sd">    referenceDate : str, optional</span>
<span class="sd">        The reference date for the time variable, typically &#39;0001-01-01&#39;,</span>
<span class="sd">        taking one of the following forms::</span>

<span class="sd">            0001-01-01</span>
<span class="sd">            0001-01-01 00:00:00</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dsOut : ``xarray.DataSet``</span>
<span class="sd">        A copy of the input data set with the `outTimeVariableName`</span>
<span class="sd">        coordinate containing the time coordinate parsed from</span>
<span class="sd">        `inTimeVariableName`.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError</span>
<span class="sd">        If the time variable has an unsupported type (not a date string</span>
<span class="sd">        or a floating-pont number of days since the start of the simulatio).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Authors</span>
    <span class="c1"># -------</span>
    <span class="c1"># Xylar Asay-Davis</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inTimeVariableName</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
        <span class="c1"># we want to average the two</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inTimeVariableName</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">dsStart</span> <span class="o">=</span> <span class="n">_parse_dataset_time</span><span class="p">(</span>
            <span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span>
            <span class="n">inTimeVariableName</span><span class="o">=</span><span class="n">inTimeVariableName</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">,</span>
            <span class="n">outTimeVariableName</span><span class="o">=</span><span class="n">outTimeVariableName</span><span class="p">,</span>
            <span class="n">referenceDate</span><span class="o">=</span><span class="n">referenceDate</span><span class="p">)</span>
        <span class="n">dsEnd</span> <span class="o">=</span> <span class="n">_parse_dataset_time</span><span class="p">(</span>
            <span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span>
            <span class="n">inTimeVariableName</span><span class="o">=</span><span class="n">inTimeVariableName</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">,</span>
            <span class="n">outTimeVariableName</span><span class="o">=</span><span class="n">outTimeVariableName</span><span class="p">,</span>
            <span class="n">referenceDate</span><span class="o">=</span><span class="n">referenceDate</span><span class="p">)</span>
        <span class="n">starts</span> <span class="o">=</span> <span class="n">dsStart</span><span class="p">[</span><span class="n">outTimeVariableName</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">ends</span> <span class="o">=</span> <span class="n">dsEnd</span><span class="p">[</span><span class="n">outTimeVariableName</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="c1"># replace the time in starts with the mean of starts and ends</span>
        <span class="n">dsOut</span> <span class="o">=</span> <span class="n">dsStart</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">dsOut</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;startTime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">outTimeVariableName</span><span class="p">,</span> <span class="n">starts</span><span class="p">)</span>
        <span class="n">dsOut</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;endTime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">outTimeVariableName</span><span class="p">,</span> <span class="n">ends</span><span class="p">)</span>

        <span class="n">dsOut</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">outTimeVariableName</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">outTimeVariableName</span><span class="p">,</span>
                                             <span class="p">[</span><span class="n">starts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span>
                                                 <span class="p">(</span><span class="n">ends</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">starts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
                                                 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">starts</span><span class="p">))])</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># there is just one time variable (either because we&#39;re recursively</span>
        <span class="c1"># calling the function or because we&#39;re not averaging).</span>

        <span class="n">timeVar</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">inTimeVariableName</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">timeVar</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="s1">&#39;|S64&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;timeVar of unsupported type </span><span class="si">{}</span><span class="s2">.  String variable &quot;</span>
                            <span class="s2">&quot;expected.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timeVar</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>

        <span class="c1"># this is an array of date strings like &#39;xtime&#39;</span>
        <span class="c1"># convert to string</span>
        <span class="n">timeStrings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xtime</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                       <span class="k">for</span> <span class="n">xtime</span> <span class="ow">in</span> <span class="n">timeVar</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
        <span class="n">days</span> <span class="o">=</span> <span class="n">string_to_days_since_date</span><span class="p">(</span><span class="n">dateString</span><span class="o">=</span><span class="n">timeStrings</span><span class="p">,</span>
                                         <span class="n">referenceDate</span><span class="o">=</span><span class="n">referenceDate</span><span class="p">,</span>
                                         <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">)</span>

        <span class="n">dsOut</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">dsOut</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">outTimeVariableName</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">outTimeVariableName</span><span class="p">,</span> <span class="n">days</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dsOut</span>  <span class="c1"># }}}</span>


<span class="c1"># vim: ai ts=4 sts=4 et sw=4 ft=python</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright This software is open source software available under the BSD-3license. Copyright (c) 2019 Triad National Security, LLC. All rights reserved. Copyright (c) 2018 Lawrence Livermore National Security, LLC. All rights reserved. Copyright (c) 2018 UT-Battelle, LLC. All rights reserved.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>