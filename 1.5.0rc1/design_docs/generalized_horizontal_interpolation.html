<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Generalized Horizontal Interpolation in MPAS-Analysis &mdash; MPAS-Analysis 1.5.0rc1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Config File Reorganization" href="config_file_reorganization.html" />
    <link rel="prev" title="Design Documents" href="../design_docs.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> MPAS-Analysis
          </a>
              <div class="version">
                1.5.0rc1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../quick_start.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis_tasks.html">Analysis Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../components.html">MPAS Components and E3SM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../observations.html">Observations</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../api.html">API reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../design_docs.html">Design Documents</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Generalized Horizontal Interpolation in MPAS-Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="config_file_reorganization.html">Config File Reorganization</a></li>
<li class="toctree-l2"><a class="reference internal" href="timekeeping_reorg.html">Reorganize Timekeeping</a></li>
<li class="toctree-l2"><a class="reference internal" href="generalize_calendar.html">Generalize Calendar supported by Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="variable_mapping_reorg.html">Moving variable mapping outside of mpas_xarray</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_tasks.html">Support Parallel Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="remapper.html">Remapper for “online” remapping of data sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="prerequisite_tasks.html">Prerequisite Tasks and Subtasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="eddykineticenergy.html">Eddy Kinetic Energy Climatology Mapping</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">Main Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html#contributors">Contributors</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../versions.html">Versions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MPAS-Analysis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../design_docs.html">Design Documents</a> &raquo;</li>
      <li>Generalized Horizontal Interpolation in MPAS-Analysis</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/design_docs/generalized_horizontal_interpolation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="generalized-horizontal-interpolation-in-mpas-analysis">
<h1>Generalized Horizontal Interpolation in MPAS-Analysis<a class="headerlink" href="#generalized-horizontal-interpolation-in-mpas-analysis" title="Permalink to this headline">¶</a></h1>
<h2>
Xylar Asay-Davis <br>
date: 2017/01/19 <br>
</h2><p>Horizontal interpolation and related utilities for remapping are now in the <a class="reference external" href="https://github.com/MPAS-Dev/pyremap/">pyremap repo</a>.</p>
<h3> Summary </h3><p>Currently, MPAS-Analysis uses various methods to perform horizontal interpolation.  For constructing ocean climatologies, nearest-neighbor interpolation is used, while for sea-ice climatologies, <code class="docutils literal notranslate"><span class="pre">ncremap</span></code> is used with the requirement that a mapping file for the appropriate source and destination grids is provided through the config file.  This project intends to move MPAS-Analysis to a unified approach to horizontal interpolation that does not require pre-generated mapping files (though it should support caching mapping files for faster execution).</p>
<p>Many types of analysis in MPAS will require fields that are interpolated from MPAS grids to arbitrary points, not just to points on a lat/lon grid.  This project will not attempt to address that case completely but will take that need into consideration in designing a solution that can be extended to interpolation at arbitrary points in the future.</p>
<h2> Requirements </h2>
<h3>Requirement: Higher-order interpolation <br>
Date last modified: 2017/02/25 <br>
Contributors: Xylar Asay-Davis</h3>

The option to interpolate smoothly (e.g. linearly or with barycentric coordinates) between cell-centered values should be added.  The calling code should easily be able to select among various orders of interpolation with a flag.

<h3>Consideration: Interpolation should handle periodic boundaries <br>
Date last modified: 2017/02/25 <br>
Contributors: Xylar Asay-Davis</h3>

If and when MPAS-Analysis supports planar test cases with periodic boundaries, interpolation should be extended to handle periodic boundaries

<h3>Consideration: Interpolation should handle Cartesian meshes <br>
Date last modified:  2017/02/25 <br>
Contributors: Xylar Asay-Davis</h3>

If and when MPAS-Analysis supports planar test cases with purely Cartesian meshes (e.g. where `latCell` and `lonCell` do not vary), interpolation should be extended to handle Cartesian Coordinates

<h3>Consideration: Support for arbitrary output interpolation points <br>
Date last modified: 2017/02/25 <br>
Contributors: Xylar Asay-Davis
</h3>

The calling code should be able to supply any desired interpolation points, not just a regular latitude-longitude grid.

<h3>Consideration: Support caching results from any costly, one-time geometric computations <br>
Date last modified: 2017/02/25 <br>
Contributors: Xylar Asay-Davis</h3>

For many potential algorithms used to perform interpolation, there is likely to be a relatively costly step of computing fields such as indices into input data fields and interpolation weights that 1) only need to be computed once for a given input mesh and set of output points and 2) are independent of the data in the field being interpolated.  If this data were cached, it could mean that rerunning the analysis (which might be very desirable, e.g., while monitoring the progress of a run) would be much cheaper than the initial run.  Also, a cached weight file from a previous analysis run could be used when analyzing a subsequent run with identical source meshes.



<h2> Algorithmic Formulations </h2><h3>Design solution: Higher-order interpolation <br>
Date last modified: 2017/02/25 <br>
Contributors: Xylar Asay-Davis</h3><p>The approach will be to create SCRIP files (or, in the future for greater flexibility perhaps ESMF grid/mesh files) for the source and destination grids, then to use <code class="docutils literal notranslate"><span class="pre">ESMF_RegridWeightGen</span></code> to generate a mapping file.  <code class="docutils literal notranslate"><span class="pre">ESMF_RegridWeightGen</span></code> supports 5 interpolation methods—bilinear, patch, nearestdtos, neareststod, and conserve—and we would likely support at least bilinear, neareststod and conserve, and perhaps all 5.  The destination grid will be specified either by reading values from <code class="docutils literal notranslate"><span class="pre">lat</span></code> and <code class="docutils literal notranslate"><span class="pre">lon</span></code> coordinates of a NetCDF file or through config file options <code class="docutils literal notranslate"><span class="pre">lat</span></code> and <code class="docutils literal notranslate"><span class="pre">lon</span></code> that are typically expressions involving <code class="docutils literal notranslate"><span class="pre">numpy.arange</span></code> or <code class="docutils literal notranslate"><span class="pre">numpy.linspace</span></code>.</p>
<p>Then, <code class="docutils literal notranslate"><span class="pre">ncremap</span></code> will be used to remap the desired list of variables from an MPAS NetCDF file to the desired destination grid.</p>
<h3>Design solution: Interpolation should handle periodic boundaries <br>
Date last modified: 2017/02/25 <br>
Contributors: Xylar Asay-Davis</h3><p>For now, periodic boundaries (except for the obvious one at +/- 180 longitude) will not be supported.  It appears that ESMF grid files do include support for periodic boundaries so the current solution should be relatively easy to extend to periodic boundaries in the future.</p>
<h3>Design solution: Interpolation should handle Cartesian meshes <br>
Date last modified:  2017/02/25 <br>
Contributors: Xylar Asay-Davis</h3><p>ESMF unstructured mesh files seem to support Cartesian coordinates.  This will be investigated if and when MPAS-Analysis can accommodate a test case with Cartesian coordinates.</p>
<h3>Design solution: Support for arbitrary output interpolation points <br>
Date last modified: 2017/02/25 <br>
Contributors: Xylar Asay-Davis
</h3><p>I do not intend to address this consideration in this project.  It may be that <code class="docutils literal notranslate"><span class="pre">ESMF_RegridWeightGen</span></code> can also be used to perform interpolation to arbitrary points (in particular, a set of points that are not cell centers or vertices of a mesh), but this is not yet clear to me.  If not, an alternative solution for arbitrary destination points will be needed.</p>
<h3>Design solution: Support caching results from any costly, one-time geometric computations <br>
Date last modified: 2017/02/25 <br>
Contributors: Xylar Asay-Davis</h3><p>This should be relatively easy to accommodate with <code class="docutils literal notranslate"><span class="pre">ESMF_RegridWeightGen</span></code> and <code class="docutils literal notranslate"><span class="pre">ncremap</span></code>.  The default behavior of the function for generating interpolation weights will be to do nothing if the mapping file already exists.  Further, we can support an optional config option that will point to an existing mapping file if one has already been generated and cached somewhere (e.g. in a shared directory).  Eventually, we will probably want to systematically store these mapping files for typical MPAS meshes and typical output grids, particularly for those that are expensive to generate.</p>
<p><span class="raw-html-m2r"><h2> Design and Implementation </h2></span></p>
<h3>Implementation: Higher-order interpolation <br>
Date last modified: 2017/03/04 <br>
Contributors: Xylar Asay-Davis</h3><p>Implementation is in the branch <a class="reference external" href="https://github.com/xylar/MPAS-Analysis/tree/horiz_interp">https://github.com/xylar/MPAS-Analysis/tree/horiz_interp</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">ESMF_RegridWeightGen</span></code> is used to compute regridding weights that are ‘bilinear’, ‘neareststod’ (nearest neighbor) or ‘conserve’ (conservative).  The order of regridding can be chosen separately for MPAS model results, ocean observations and sea-ice observationos via <code class="docutils literal notranslate"><span class="pre">mpasInterpolationMethod</span></code> and <code class="docutils literal notranslate"><span class="pre">interpolationMethod</span></code> flags (see the template: <a class="reference external" href="https://github.com/xylar/MPAS-Analysis/blob/horiz_interp/config.template">https://github.com/xylar/MPAS-Analysis/blob/horiz_interp/config.template</a>).</p>
<h3>Implementation: Interpolation should handle periodic boundaries <br>
Date last modified: 2017/03/04 <br>
Contributors: Xylar Asay-Davis</h3><p>Not yet supported.</p>
<h3>Implementation: Interpolation should handle Cartesian meshes <br>
Date last modified:  2017/03/04 <br>
Contributors: Xylar Asay-Davis</h3><p>Not yet supported.</p>
<h3>Implementation: Support for arbitrary output interpolation points <br>
Date last modified: 2017/03/04 <br>
Contributors: Xylar Asay-Davis
</h3><p>Not yet supported.</p>
<h3>Implementation: Support caching results from any costly, one-time geometric computations <br>
Date last modified: 2017/02/25 <br>
Contributors: Xylar Asay-Davis</h3><p>Mapping files, climatologies and remapped climatologies are cached when they are created.  Both mapping files and the directory containing the remapped climatologies from observations can be supplied via the config file, saving the time of computing them.</p>
<p><span class="raw-html-m2r"><h2> Testing </h2></span></p>
<h3>Testing and Validation: Higher-order interpolation <br>
Date last modified: 2017/03/04 <br>
Contributors: Xylar Asay-Davis</h3><p>Testing of each of the flags (‘bilinear’, ‘neareststod’ and ‘conserve’) has been performed with the <code class="docutils literal notranslate"><span class="pre">GMPAS-QU240</span></code> run, all of wich produce plots that look acceptable.  Bilinear and conserve methods leave halos of invalid cells around land at coarse resolution, which is consistent with the coarse resolution of this test mesh.</p>
<p>An alpha8 and a beta0 run on edison.  They ran successfully but I have not had a chance to examine the output.</p>
<h3>Testing and Validation: Interpolation should handle periodic boundaries <br>
Date last modified: 2017/03/04 <br>
Contributors: Xylar Asay-Davis</h3><p>Not yet supported.</p>
<h3>Testing and Validation: Interpolation should handle Cartesian meshes <br>
Date last modified:  2017/03/04 <br>
Contributors: Xylar Asay-Davis</h3><p>Not yet supported.</p>
<h3>Testing and Validation: Support for arbitrary output interpolation points <br>
Date last modified: 2017/03/04 <br>
Contributors: Xylar Asay-Davis
</h3><p>Not yet supported.</p>
<h3>Testing and Validation: Support caching results from any costly, one-time geometric computations <br>
Date last modified: 2017/02/25 <br>
Contributors: Xylar Asay-Davis</h3><p>I have verified that I can rerun without re-computing mapping files or climatologies.  Using the <code class="docutils literal notranslate"><span class="pre">GMPAS-QU240</span></code> run, I have verified that I can supply mapping files and remapped observation climatologies without them being re-computed</p>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../design_docs.html" class="btn btn-neutral float-left" title="Design Documents" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="config_file_reorganization.html" class="btn btn-neutral float-right" title="Config File Reorganization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright This software is open source software available under the BSD-3license. Copyright (c) 2020 Triad National Security, LLC. All rights reserved. Copyright (c) 2018 Lawrence Livermore National Security, LLC. All rights reserved. Copyright (c) 2018 UT-Battelle, LLC. All rights reserved..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>