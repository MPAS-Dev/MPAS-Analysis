<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Climatology &mdash; MPAS-Analysis 1.11.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/documentation_options.js?v=6cf1fb80"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Time Series" href="timeSeries.html" />
    <link rel="prev" title="Output" href="output.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            MPAS-Analysis
          </a>
              <div class="version">
                1.11.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User's guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quick_start.html">Quick Start Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../configuration.html">Configuration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="runs.html">Runs</a></li>
<li class="toctree-l2"><a class="reference internal" href="execute.html">Execute</a></li>
<li class="toctree-l2"><a class="reference internal" href="dask_threads.html">Dask threads and subprocess count</a></li>
<li class="toctree-l2"><a class="reference internal" href="diagnostics.html">Diagnostics</a></li>
<li class="toctree-l2"><a class="reference internal" href="input.html">Input</a></li>
<li class="toctree-l2"><a class="reference internal" href="output.html">Output</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Climatology</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#start-and-end-year">Start and End Year</a></li>
<li class="toctree-l3"><a class="reference internal" href="#anomaly-reference-year">Anomaly Reference Year</a></li>
<li class="toctree-l3"><a class="reference internal" href="#remapping-options">Remapping Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#computing-climatologies">Computing climatologies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-options">Other Options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="timeSeries.html">Time Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html">Index</a></li>
<li class="toctree-l2"><a class="reference internal" href="regions.html">Regions</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot.html">Plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="html.html">HTML</a></li>
<li class="toctree-l2"><a class="reference internal" href="observations.html">Ocean, Sea Ice and Iceberg Observations</a></li>
<li class="toctree-l2"><a class="reference internal" href="preprocessed.html">Preprocessed Reference Runs</a></li>
<li class="toctree-l2"><a class="reference internal" href="colormaps.html">Colormaps</a></li>
<li class="toctree-l2"><a class="reference internal" href="seasons.html">Seasons</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_grids.html">Comparison Grids</a></li>
<li class="toctree-l2"><a class="reference internal" href="moving_average.html">Moving Average</a></li>
<li class="toctree-l2"><a class="reference internal" href="time_axis_ticks.html">Time-Axis Tick Marks</a></li>
<li class="toctree-l2"><a class="reference internal" href="transects.html">Output Grids for Transects</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../analysis_tasks.html">Analysis Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../components.html">MPAS Components and E3SM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../observations.html">Observations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer's guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../developers_guide/api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design_docs/index.html">Design Documents</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/getting_started.html">User: Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/dev_getting_started.html">Developer: Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/dev_understand_a_task.html">Developers: Understanding an analysis task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/dev_add_task.html">Developers: Adding a new analysis task</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Authors</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Main Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html#contributors">Contributors</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../versions.html">Versions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MPAS-Analysis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../configuration.html">Configuration</a></li>
      <li class="breadcrumb-item active">Climatology</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/users_guide/config/climatology.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="climatology">
<span id="config-climatology"></span><h1>Climatology<a class="headerlink" href="#climatology" title="Link to this heading">Â¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">[climatology]</span></code> section of a configuration file contains options used to
determine the start and end years of climatologies, the reference years for
anomalies and to control remapping of climatologies to comparions grids:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">climatology</span><span class="p">]</span>
<span class="c1">## options related to producing climatologies, typically to compare against</span>
<span class="c1">## observations and previous runs</span>

<span class="c1"># the year from which to compute anomalies if not the start year of the</span>
<span class="c1"># simulation.  This might be useful if a long spin-up cycle is performed and</span>
<span class="c1"># only the anomaly over a later span of years is of interest.</span>
<span class="c1"># anomalyRefYear = 249</span>

<span class="c1"># the first year over which to average climatalogies</span>
<span class="n">startYear</span> <span class="o">=</span> <span class="mi">11</span>
<span class="c1"># the last year over which to average climatalogies</span>
<span class="n">endYear</span> <span class="o">=</span> <span class="mi">20</span>

<span class="c1"># The comparison lat/lon grid resolution in degrees</span>
<span class="n">comparisonLatResolution</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">comparisonLonResolution</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="c1"># The comparison Antarctic polar stereographic grid size and resolution in km</span>
<span class="n">comparisonAntarcticStereoWidth</span> <span class="o">=</span> <span class="mf">6000.</span>
<span class="n">comparisonAntarcticStereoResolution</span> <span class="o">=</span> <span class="mf">10.</span>

<span class="c1"># interpolation order for model and observation results. Likely values are</span>
<span class="c1">#   &#39;bilinear&#39;, &#39;neareststod&#39; (nearest neighbor) or &#39;conserve&#39;</span>
<span class="n">mpasInterpolationMethod</span> <span class="o">=</span> <span class="n">bilinear</span>

<span class="c1"># should climatologies be performed with ncclimo or with xarray/dask</span>
<span class="n">useNcclimo</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># should remapping be performed with ncremap or with the Remapper class</span>
<span class="c1"># directly in MPAS-Analysis</span>
<span class="n">useNcremap</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># The minimum weight of a destination cell after remapping. Any cell with</span>
<span class="c1"># weights lower than this threshold will therefore be masked out.</span>
<span class="n">renormalizationThreshold</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="c1"># if useNcclimo = False, the number of threads dask is allowed to spawn for</span>
<span class="c1"># each process computing a climatology for a given month or season</span>
<span class="c1"># Decrease this number if mpasClimatology* subtasks are running</span>
<span class="c1"># out of available threads</span>
<span class="n">daskThreads</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># if useNcclimo = False, the number of subprocesses that each climatology</span>
<span class="c1"># subtask gets counted as occupying.</span>
<span class="c1"># Increase this number if mpasClimatology* subtasks are running</span>
<span class="c1"># out of memory, and fewer tasks will be allowed to run at once</span>
<span class="n">subprocessCount</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<section id="start-and-end-year">
<h2>Start and End Year<a class="headerlink" href="#start-and-end-year" title="Link to this heading">Â¶</a></h2>
<p>A custom config file should specify a start and end year for climatologies.
Simulation data must exist for all 12 months of each year in this range.
Otherwise, the range will be reduced to those years with complete data and
a warning message will be displayed.</p>
</section>
<section id="anomaly-reference-year">
<h2>Anomaly Reference Year<a class="headerlink" href="#anomaly-reference-year" title="Link to this heading">Â¶</a></h2>
<p>Anomalies between a climatology and the associated field from a reference year
is used in a few analysis tasks.  By default, the reference year is not
specified in the configuration file and it taken to be the start of the
simulation (determined from the contents of a restart file).  Under certain
circumstances (e.g. repetition of forcing data for several cycles, as in
the <a class="reference external" href="http://data1.gfdl.noaa.gov/nomads/forms/mom4/CORE.html">Common Ocean Reference Experiments, CORE</a>), it may be desirable to
specify a different year to use for computing anomalies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">anomalyRefYear</span> <span class="o">=</span> <span class="mi">249</span>
</pre></div>
</div>
</section>
<section id="remapping-options">
<span id="config-remapping"></span><h2>Remapping Options<a class="headerlink" href="#remapping-options" title="Link to this heading">Â¶</a></h2>
<p>Climatologies are remapped from MPAS meshes and observations grids to common
comparison grids.  The remapping can be performed with any of three methods:
<code class="docutils literal notranslate"><span class="pre">bilinear</span></code>, <code class="docutils literal notranslate"><span class="pre">neareststod</span></code> (nearest neighbor) or <code class="docutils literal notranslate"><span class="pre">conserve</span></code>.  Mapping
files are created with the <a class="reference external" href="http://www.earthsystemmodeling.org/esmf_releases/public/ESMF_7_1_0r/ESMF_refdoc/node3.html#SECTION03020000000000000000">ESMF_RegridWeightGen tool</a>.  The default method
is <code class="docutils literal notranslate"><span class="pre">bilinear</span></code> and these are the mapping files distributed from the
<a class="reference external" href="https://web.lcrc.anl.gov/public/e3sm/diagnostics/">E3SM public data repository</a>.  The <code class="docutils literal notranslate"><span class="pre">conseve</span></code> method is know to be <em>much</em>
slower to compute and should only be used if it is necessary (e.g. because
remapped data will be checked for conservation).</p>
<p>MPAS-Analysis typically uses the <a class="reference external" href="http://nco.sourceforge.net/nco.html">NCO</a> tool <code class="docutils literal notranslate"><span class="pre">ncremap</span></code> to perform remapping.
However, a python remapping capability is also available.  The user can force
remapping to use the python-based remapping by specifying:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">useNcremap</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>This capability is available largely for debugging purposes.</p>
<p>Remapped data typically only makes sense if it is renormalized after remapping.
For remapping of conserved quatntities like fluxes, renormalization would not
be desirable but for quantities like potential temperature, salinity and
potential density commonly used in MPAS-Anlaysis tasks, values become
physically meaningless near land boundaries and regions without data unless
renormalization is performed.  A threshold is needed to determine how much of a
cellâs area on the output grid must contain valid data from the input grid or
mesh, below which that cell is considered invalid and is masked out of the
destination data set.  This threshold is specified as a fraction:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">renormalizationThreshold</span> <span class="o">=</span> <span class="mf">0.01</span>
</pre></div>
</div>
<p>If noisy or unphysical values occur near maked regions on the comparison grid,
it might be necessary to increase this threshold.  If too much data appears to
be being masked out unnecessarily on the comparison grid, perhaps this value
should be made smaller.</p>
</section>
<section id="computing-climatologies">
<h2>Computing climatologies<a class="headerlink" href="#computing-climatologies" title="Link to this heading">Â¶</a></h2>
<p>MPAS-Analysis typically uses the <a class="reference external" href="http://nco.sourceforge.net/nco.html">NCO</a> tool <code class="docutils literal notranslate"><span class="pre">ncclimo</span></code> to compute
climatologies.  For some large data sets on a single node, <code class="docutils literal notranslate"><span class="pre">ncclimo</span></code> runs
out of memory in <code class="docutils literal notranslate"><span class="pre">bck</span></code> mode but is painfully slow in <code class="docutils literal notranslate"><span class="pre">serial</span></code> mode and
wastes extra nodes in <code class="docutils literal notranslate"><span class="pre">mpi</span></code> mode.  (See :ref: <cite>config_execute</cite> for more on
configuring <code class="docutils literal notranslate"><span class="pre">ncclimo</span></code>.)  For such cases, there is also an xarray/dask method
of computing climatologies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">useNcremap</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</section>
<section id="other-options">
<h2>Other Options<a class="headerlink" href="#other-options" title="Link to this heading">Â¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="comparison_grids.html#config-comparison-grids"><span class="std std-ref">Comparison Grids</span></a></p></li>
<li><p><a class="reference internal" href="dask_threads.html#dask-threads"><span class="std std-ref">Dask threads and subprocess count</span></a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="output.html" class="btn btn-neutral float-left" title="Output" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="timeSeries.html" class="btn btn-neutral float-right" title="Time Series" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright This software is open source software available under the BSD-3license. Copyright (c) 2022 Triad National Security, LLC. All rights reserved. Copyright (c) 2018 Lawrence Livermore National Security, LLC. All rights reserved. Copyright (c) 2018 UT-Battelle, LLC. All rights reserved..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>